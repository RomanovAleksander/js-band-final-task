(this["webpackJsonpjs-band-final-task"]=this["webpackJsonpjs-band-final-task"]||[]).push([[0],{33:function(e,t,a){e.exports=a(53)},42:function(e,t,a){},44:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},48:function(e,t,a){},49:function(e,t,a){},50:function(e,t,a){},51:function(e,t,a){},52:function(e,t,a){},53:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(20),c=a.n(o),i=a(2),l=a(16),s=a(14),u=(a(42),Object(i.b)((function(e){return{booksInCart:e.bookDetails.booksInCart,username:e.userData.username,avatar:e.userData.avatar,token:e.userData.token,isAuthorized:e.userData.isAuthorized}}))((function(e){var t=e.username,a=e.avatar,n=e.isAuthorized,o=e.booksInCart,c=r.a.createElement("div",{className:"shop-menu"},r.a.createElement(l.b,{to:"/cart"},r.a.createElement("i",{className:"cart fa fa-shopping-cart"}),r.a.createElement("span",{className:"cart-count"},o)),r.a.createElement("div",{className:"menu-item"},r.a.createElement("button",{className:"btn btn-primary"},"Sign-Out")),r.a.createElement("div",{className:"menu-item row"},r.a.createElement("img",{src:a,alt:"avatar",className:"rounded-circle"}),r.a.createElement("div",{className:"userName"},t)));return r.a.createElement("header",{className:"shop-header row"},r.a.createElement(l.b,{to:"/books"},r.a.createElement("div",{className:"logo"},"JS BAND STORE / Oleksandr Romanov")),n?c:null)}))),m=a(5),b=a(6),p=a(10),d=a(9),f=a(11),h=(a(44),function(e){var t=e.book,a=e.onView,n=t.title,o=t.author,c=t.price,i=t.cover;return r.a.createElement("div",{className:"book-list-item"},r.a.createElement("img",{src:i,alt:"cover",className:"cart-img-top"}),r.a.createElement("div",{className:"book-details"},r.a.createElement("div",{className:"book-title"},n),r.a.createElement("div",{className:"book-author"},o)),r.a.createElement("div",{className:"book-footer"},r.a.createElement("div",{className:"book-price"},c," $"),r.a.createElement("button",{onClick:a,className:"btn btn-primary"},"View")))}),E=a(19),v=a.n(E),k=a(27),O=new(function(){function e(){Object(m.a)(this,e),this._url="https://js-band-api.glitch.me"}return Object(b.a)(e,[{key:"fetchData",value:function(){var e=Object(k.a)(v.a.mark((function e(t,a){var n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("".concat(this._url).concat(t),a);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("Invalid request");case 6:return e.next=8,n.json();case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",e.t0);case 14:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(k.a)(v.a.mark((function e(t,a){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchData(t,{mode:"cors",headers:{Authorization:"Bearer ".concat(a)}}));case 1:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"post",value:function(e,t,a){var n={"Content-Type":"application/json"};return a&&(n.Authorization="Bearer ".concat(a)),this.fetchData(e,{method:"POST",mode:"cors",headers:n,body:JSON.stringify(t)})}}]),e}()),y=(a(46),function(){return r.a.createElement("div",{className:"spinner"},r.a.createElement("div",{className:"loadingio-spinner-double-ring-5gwf7wyqw2d"},r.a.createElement("div",{className:"ldio-mrii3anle"},r.a.createElement("div",null," "),r.a.createElement("div",null," "),r.a.createElement("div",null,r.a.createElement("div",null," ")),r.a.createElement("div",null,r.a.createElement("div",null," ")))))}),g=(a(47),function(e){var t=e.books,a=e.onView;return r.a.createElement("ul",{className:"book-list"},t.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(h,{book:e,onView:function(){return a(e.id)}}))})))}),C=function(e){function t(){return Object(m.a)(this,t),Object(p.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.booksLoaded,a=e.booksRequested,n=e.token;a(),O.get("/books",n).then((function(e){return t(e)})).catch((function(){}))}},{key:"search",value:function(e,t){return 0===t?e:e.filter((function(e){return e.title.toLowerCase().indexOf(t.toLowerCase())>-1}))}},{key:"filterByPrice",value:function(e,t){switch(t){case"all":return e;case"0-15":return e.filter((function(e){return e.price>=0&&e.price<15}));case"15-30":return e.filter((function(e){return e.price>=15&&e.price<=30}));case">30":return e.filter((function(e){return e.price>30}));default:return e}}},{key:"render",value:function(){var e=this.props,t=e.books,a=e.loading,n=e.searchText,o=e.filterPrice,c=e.onView,i=e.isAuthorized;if(a)return r.a.createElement(y,null);if(!i)return r.a.createElement("div",null,"Not Found");if(t){var l=this.filterByPrice(this.search(t,n),o);return r.a.createElement(g,{onView:c,books:l})}}}]),t}(r.a.Component),j={booksLoaded:function(e){return{type:"FETCH_BOOKS_SUCCESS",payload:e}},booksRequested:function(){return{type:"FETCH_BOOKS_REQUEST"}}},N=Object(i.b)((function(e){return{books:e.bookList.books,searchText:e.bookList.searchText,filterPrice:e.bookList.filterPrice,token:e.userData.token,isAuthorized:e.userData.isAuthorized,loading:e.bookList.loading}}),j)(C),S=(a(48),function(e){function t(){var e,a;Object(m.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(p.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(r)))).onSearchChange=function(e){var t=e.target;(0,a.props.searchBooks)(t.value)},a.handleFilterChange=function(e){var t=e.target;(0,a.props.filterBooks)(t.value)},a}return Object(f.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.props,t=e.searchText,a=e.filterPrice;return r.a.createElement("div",{className:"filter-wrapper"},r.a.createElement("input",{type:"search",className:"form-control mr-sm-2",placeholder:"search by title",onChange:this.onSearchChange,value:t}),r.a.createElement("select",{className:"select-status select",key:"status",onChange:this.handleFilterChange,value:a},r.a.createElement("option",{value:"all"},"Price"),r.a.createElement("option",{value:"0-15"},"0-15"),r.a.createElement("option",{value:"15-30"},"15-30"),r.a.createElement("option",{value:">30"},">30")))}}]),t}(r.a.Component)),w={searchBooks:function(e){return{type:"SEARCH_BOOKS",payload:{searchText:e}}},filterBooks:function(e){return{type:"FILTER_BOOKS",payload:{filterPrice:e}}}},x=Object(i.b)((function(e){return{searchText:e.bookList.searchText,filterPrice:e.bookList.filterPrice}}),w)(S),D=Object(s.g)((function(e){var t=e.history;return r.a.createElement(r.a.Fragment,null,r.a.createElement(x,null),r.a.createElement(N,{onView:function(e){t.push("/books/".concat(e))}}))})),P=(a(49),{purchaseBooks:function(){return{type:"PURCHASE_SUCCESS"}}}),T=Object(i.b)((function(e){return{items:e.bookDetails.cartItems,total:e.bookDetails.orderTotal,isCartEmpty:e.bookDetails.isCartEmpty}}),P)((function(e){var t=e.items,a=e.total,n=e.purchaseBooks,o=e.isCartEmpty,c=r.a.createElement("div",{className:"container text-center"},r.a.createElement("i",{className:"cart fa fa-shopping-cart cartEmpty"}),r.a.createElement("p",{className:"cartEmptyText"},"Cart empty...")),i=r.a.createElement("div",{className:"table-wrapper"},r.a.createElement("table",null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Book title:"),r.a.createElement("th",null,"Count:"),r.a.createElement("th",null,"Total price:"))),r.a.createElement("tbody",null,t.map((function(e){var t=e.id,a=e.title,n=e.count,o=e.totalPrice;return r.a.createElement("tr",{key:t},r.a.createElement("td",null,a),r.a.createElement("td",null,n),r.a.createElement("td",null,o))})))),r.a.createElement("div",{className:"total"},"Total price, $ ",a));return r.a.createElement("div",{className:"cart-container"},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){O.post("/purchase",{books:t},"5686wvoxndcplla5xi8qte").then((function(e){console.log(e)})).then((function(){n()}))},disabled:o},"Purchase"),o?c:i)})),_=function(){return r.a.createElement(T,null)},F=(a(50),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(d.a)(t).call(this))).onChange=function(t){var a=t.target;e.setState({username:a.value})},e.onSubmit=function(t){t.preventDefault();var a=e.state.username;O.post("/signin",{username:a}).then((function(t){e.props.usernameLoaded(t),console.log(t)}))},e.state={username:"",minLength:4,maxLength:16},e}return Object(f.a)(t,e),Object(b.a)(t,[{key:"render",value:function(){var e=this.state,t=e.username,a=e.minLength,n=e.maxLength,o=t.length>=a&&t.length<=n?"is-valid":"is-invalid";return r.a.createElement("div",{className:"container d-flex justify-content-center"},r.a.createElement("form",{className:"d-flex flex-column align-items-center",onSubmit:this.onSubmit},r.a.createElement("img",{src:"https://api.adorable.io/avatars/100/orange.png",alt:"avatar",className:"sign-in-avatar"}),r.a.createElement("label",{className:"d-flex flex-column align-items-center",htmlFor:"sign-in-input"},r.a.createElement("b",null,"Username"),r.a.createElement("div",{className:"d-flex flex-column justify-content-start mt-2"},r.a.createElement("input",{type:"text",className:"form-control ".concat(o),onChange:this.onChange,max:n,min:a,value:t,placeholder:"type Username",id:"sign-in-input",required:!0}),r.a.createElement("div",{className:"invalid-feedback text-center"},"Field is not valid!"))),r.a.createElement("button",{className:"btn btn-primary sign-in w-100",type:"submit"},"Sign-In")))}}]),t}(r.a.Component)),A={usernameLoaded:function(e){return{type:"FETCH_USER_SUCCESS",payload:e}}},B=Object(i.b)(null,A)(F),I=function(){return r.a.createElement(B,null)},L=(a(51),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(d.a)(t).call(this))).onCountChange=function(t){var a=t.target;e.setState({booksCount:parseFloat(a.value)})},e.onSubmit=function(t){t.preventDefault();var a=e.props,n=a.book,r=a.bookAddedToCart,o=e.state.booksCount;r(n.id,o),e.setState({booksCount:0})},e.state={booksCount:1},e}return Object(f.a)(t,e),Object(b.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.bookLoaded,a=e.bookRequested,n=e.bookId,r=e.token;a(),O.get("/books/".concat(n),r).then((function(e){t(e)}))}},{key:"render",value:function(){var e=this.props,t=e.book,a=e.loading,n=e.maxCount,o=e.minCount,c=e.cartItems,i=e.isAuthorized,l=this.state.booksCount,s=c.findIndex((function(e){return e.id===t.id})),u=c[s],m=u?u.count:0;if(a)return r.a.createElement(y,null);if(!i)return r.a.createElement("div",null,"Not Found");if(t){var b=t.title,p=t.author,d=t.level,f=t.tags,h=t.cover,E=t.description,v=t.price,k=n-m,O=l<=k||isNaN(l)?"is-valid":"is-invalid",g=(v*l).toFixed(2),C=isNaN(l)?0:g;return r.a.createElement("main",{className:"container book-page"},r.a.createElement("div",{className:"book-details-wrapper"},r.a.createElement("div",{className:"main-details"},r.a.createElement("img",{src:h,alt:"cover",className:"cart-img"}),r.a.createElement("div",{className:"book-details"},r.a.createElement("div",{className:"book-title"},r.a.createElement("b",null,"Title: "),b),r.a.createElement("div",{className:"book-author"},r.a.createElement("b",null,"Author: "),p),r.a.createElement("div",{className:"book-level"},r.a.createElement("b",null,"Level: "),d),r.a.createElement("div",{className:"book-tags"},r.a.createElement("b",null,"Tags: "),f))),r.a.createElement("div",{className:"description"},r.a.createElement("b",null,"Description: "),E)),r.a.createElement("form",{className:"price-wrapper",onSubmit:this.onSubmit},r.a.createElement("div",{className:"price-counter"},r.a.createElement("div",{className:"price-item"},r.a.createElement("b",null,"Price, $"),r.a.createElement("b",null,v)),r.a.createElement("label",{className:"counter-wrapper",htmlFor:"count-input"},r.a.createElement("b",null,"Count"),r.a.createElement("div",{className:"input-wrapper"},r.a.createElement("input",{type:"number",className:"counter form-control ".concat(O),onChange:this.onCountChange,max:k,min:o,value:l,id:"count-input",required:!0}),r.a.createElement("div",{className:"invalid-feedback"},"We don't have so much!"))),r.a.createElement("div",{className:"price-item"},r.a.createElement("b",null,"Total price"),r.a.createElement("b",null,C))),r.a.createElement("button",{className:"btn btn-primary add-to-cart",type:"submit"},"Add to cart")))}}}]),t}(r.a.Component)),R={bookLoaded:function(e){return{type:"FETCH_BOOK_SUCCESS",payload:e}},bookRequested:function(){return{type:"FETCH_BOOK_REQUEST"}},bookAddedToCart:function(e,t){return{type:"BOOK_ADDED_TO_CART",payload:{bookId:e,count:t}}}},U=Object(i.b)((function(e){return{book:e.bookDetails.book,maxCount:e.bookDetails.maxCount,minCount:e.bookDetails.minCount,cartItems:e.bookDetails.cartItems,token:e.userData.token,isAuthorized:e.userData.isAuthorized,loading:e.bookDetails.loading}}),R)(L),H=(a(52),function(e){function t(){var e;return Object(m.a)(this,t),(e=Object(p.a)(this,Object(d.a)(t).call(this))).state={hasError:!1},e}return Object(f.a)(t,e),Object(b.a)(t,[{key:"componentDidCatch",value:function(){this.setState({hasError:!0})}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("div",null,"Error"):this.props.children}}]),t}(r.a.Component)),K=a(15),z=a(32),q=a(17),V=a(22);function J(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Q(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?J(Object(a),!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):J(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var M={book:null,bookId:null,maxCount:0,minCount:0,cartItems:[],orderTotal:0,booksInCart:0,isCartEmpty:!0,purchaseMessage:null,loading:!0},$=function(e,t,a){return-1===a?[].concat(Object(V.a)(e),[t]):[].concat(Object(V.a)(e.slice(0,a)),[t],Object(V.a)(e.slice(a+1)))},W=function(e,t,a){if(t){var n=t.totalPrice+e.price*a;return Q({},t,{count:t.count+a,totalPrice:parseFloat(n.toFixed(2))})}return Q({},t,{id:e.id,count:a,totalPrice:parseFloat((e.price*a).toFixed(2)),title:e.title})};function G(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?G(Object(a),!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):G(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Y={books:[],searchText:"",filterPrice:"all",loading:!0};function Z(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ee(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(a),!0).forEach((function(t){Object(q.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Z(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var te={username:"Alex",avatar:"https://api.adorable.io/avatars/100/orange.png",token:"iflhou39qa5qswkg4eakb",isAuthorized:!0},ae=Object(K.combineReducers)({bookList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"FETCH_BOOKS_REQUEST":return X({},e,{books:[],loading:!0});case"FETCH_BOOKS_SUCCESS":return X({},e,{books:n,loading:!1});case"SEARCH_BOOKS":return X({},e,{searchText:n.searchText});case"FILTER_BOOKS":return X({},e,{filterPrice:n.filterPrice});default:return e}},bookDetails:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"FETCH_BOOK_REQUEST":return Q({},e,{book:[],loading:!0});case"FETCH_BOOK_SUCCESS":return Q({},e,{book:n,maxCount:n.count,loading:!1});case"PURCHASE_SUCCESS":return Q({},M);case"BOOK_ADDED_TO_CART":var r=e.book,o=e.cartItems,c=e.orderTotal,i=e.booksInCart,l=o.findIndex((function(e){return e.id===n.bookId})),s=o[l],u=W(r,s,n.count),m=parseFloat((c+r.price*n.count).toFixed(2)),b=i+n.count;return Q({},e,{isCartEmpty:!1,cartItems:$(e.cartItems,u,l),orderTotal:m,booksInCart:b});default:return e}},userData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0,a=t.type,n=t.payload;switch(a){case"FETCH_USER_SUCCESS":return ee({},n,{isAuthorized:!0});default:return e}}}),ne=Object(K.createStore)(ae,Object(z.composeWithDevTools)());c.a.render(r.a.createElement(i.a,{store:ne},r.a.createElement(H,null,r.a.createElement(l.a,null,r.a.createElement((function(){return r.a.createElement("div",{className:"container"},r.a.createElement(u,null),r.a.createElement(s.d,null,r.a.createElement(s.a,{from:"/",to:"/signin",exact:!0}),r.a.createElement(s.b,{path:"/signin",component:I}),r.a.createElement(s.b,{path:"/books",component:D,exact:!0}),r.a.createElement(s.b,{path:"/cart",component:_}),r.a.createElement(s.b,{path:"/books/:id",render:function(e){var t=e.match.params.id;return t>77?r.a.createElement("div",null,"Not Found"):r.a.createElement(U,{bookId:t})}})))}),null)))),document.getElementById("root"))}},[[33,1,2]]]);
//# sourceMappingURL=main.f6bd79e9.chunk.js.map